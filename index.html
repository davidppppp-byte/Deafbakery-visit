<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è’™æ©è½éšœçƒ˜ç„™åŠåƒè¨ªç”³è«‹</title>
    <!-- å¼•å…¥ Tailwind CSS (æ¨£å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React (æ ¸å¿ƒ) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- å¼•å…¥ Babel (è®“ç€è¦½å™¨çœ‹æ‡‚ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* å¢åŠ æ·¡å…¥å‹•ç•« */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // ------------------------------------------------------------------
        // Firebase è¨­å®šèˆ‡åˆå§‹åŒ– (ç›´æ¥ä½¿ç”¨ CDN)
        // ------------------------------------------------------------------
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, updateDoc, doc, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBRXTP7MpTGoyq_jm6CHFVGNY1U-zNvpPs",
            authDomain: "deafbakery-visit.firebaseapp.com",
            projectId: "deafbakery-visit",
            storageBucket: "deafbakery-visit.firebasestorage.app",
            messagingSenderId: "150016655038",
            appId: "1:150016655038:web:046f394ecdfcbce9b6a8ef"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const COLLECTION_NAME = 'visit_applications';

        const { useState, useEffect } = React;

        // ------------------------------------------------------------------
        // ä¸»ç¨‹å¼ (React Components)
        // ------------------------------------------------------------------
        const VisitSystem = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home'); 
            const [applications, setApplications] = useState([]);
            const [isAdmin, setIsAdmin] = useState(false);
            const [notification, setNotification] = useState(null);
            const [loading, setLoading] = useState(true);
            const [isDemoMode, setIsDemoMode] = useState(false);
            const [configError, setConfigError] = useState(null);

            // 1. é©—è­‰ç™»å…¥ç‹€æ…‹
            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    if (currentUser) {
                        setUser(currentUser);
                        setConfigError(null);
                    } else {
                        signInAnonymously(auth).catch((error) => {
                            console.error("åŒ¿åç™»å…¥å¤±æ•—:", error);
                            setIsDemoMode(true);
                            setUser({ uid: 'demo-user', isAnonymous: true });

                            if (error.code === 'auth/configuration-not-found' || error.code === 'auth/operation-not-allowed') {
                                setConfigError("è«‹è‡³ Firebase Console > Authentication é–‹å•Ÿã€ŒAnonymousã€");
                            } else if (error.code === 'auth/unauthorized-domain') {
                                setConfigError(`ç¶²åŸŸæœªæˆæ¬Šï¼šè«‹è‡³ Firebase Console æ–°å¢ç¶²å€ï¼š${window.location.hostname}`);
                            } else {
                                setConfigError(`é€£ç·šé©—è­‰å¤±æ•— (${error.code})`);
                            }
                            showNotification("åµæ¸¬åˆ°è¨­å®šå•é¡Œï¼Œå·²åˆ‡æ›è‡³æœ¬æ©Ÿæ¼”ç¤ºæ¨¡å¼", "warning");
                        });
                    }
                });
                return () => unsubscribe();
            }, []);

            // 2. ç›£è½è³‡æ–™åº« (åƒ…å¾Œå°)
            useEffect(() => {
                if (isDemoMode || !isAdmin || (!user && !isDemoMode)) {
                    setLoading(false);
                    return;
                }

                const q = query(collection(db, COLLECTION_NAME), orderBy('submitDate', 'desc'));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const apps = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setApplications(apps);
                    setLoading(false);
                }, (error) => {
                    console.error("Data fetch error:", error);
                    if (error.code === 'permission-denied') {
                        showNotification("æ¬Šé™ä¸è¶³ï¼šè«‹æª¢æŸ¥ Firestore Rules", "error");
                    }
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [isAdmin, user, isDemoMode]);

            // è¡¨å–®è³‡æ–™
            const [formData, setFormData] = useState({
                groupName: '', groupType: '', groupTypeOther: '',
                visitDate: '', timeStart: '', timeEnd: '',
                contactPerson: '', jobTitle: '', phone: '', email: '',
                visitorCount: '', identity: [], disabledCount: '',
                needs: [], needsOther: '', volunteerCert: false, expectations: ''
            });

            // é¡¯ç¤ºé€šçŸ¥
            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 4000);
            };

            // è™•ç†è¡¨å–®è¼¸å…¥
            const handleChange = (e) => {
                const { name, value, type, checked } = e.target;
                if (type === 'checkbox') {
                    if (name === 'volunteerCert') {
                        setFormData(prev => ({ ...prev, [name]: checked }));
                    } else if (name === 'needs' || name === 'identity') {
                        const val = value;
                        setFormData(prev => {
                            const currentList = prev[name];
                            const newList = checked ? [...currentList, val] : currentList.filter(item => item !== val);
                            return { ...prev, [name]: newList };
                        });
                    }
                } else {
                    setFormData(prev => ({ ...prev, [name]: value }));
                }
            };

            // é€å‡ºè¡¨å–®
            const handleSubmit = async (e) => {
                e.preventDefault();
                const today = new Date();
                const visitDate = new Date(formData.visitDate);
                const diffTime = Math.abs(visitDate - today);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays < 30) {
                    if(!window.confirm("æé†’æ‚¨ï¼šåƒè¨ªå»ºè­°æ–¼ä¸€å€‹æœˆå‰ç”³è«‹ä»¥åˆ©å®‰æ’ã€‚æ‚¨ç¢ºå®šè¦é€å‡ºå—ï¼Ÿ")) return;
                }
                if (formData.identity.length === 0) {
                    showNotification('è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®åƒè¨ªäººèº«ä»½åˆ¥', 'error');
                    return;
                }

                const newApp = {
                    id: isDemoMode ? Date.now().toString() : undefined,
                    submitDate: new Date().toISOString().split('T')[0],
                    createdAt: new Date().toISOString(),
                    ...formData,
                    groupType: formData.groupType === 'å…¶ä»–' ? formData.groupTypeOther : formData.groupType,
                    needs: formData.needs.includes('å…¶ä»–ç›®çš„') ? [...formData.needs.filter(n => n !== 'å…¶ä»–ç›®çš„'), formData.needsOther] : formData.needs,
                    status: 'pending'
                };

                if (isDemoMode) {
                    setApplications(prev => [newApp, ...prev]);
                    showNotification('æ¼”ç¤ºæ¨¡å¼ï¼šè³‡æ–™å·²æš«å­˜æ–¼ç€è¦½å™¨', 'warning');
                    setView('success');
                    resetForm();
                } else {
                    try {
                        await addDoc(collection(db, COLLECTION_NAME), newApp);
                        showNotification('ç”³è«‹å·²é€å‡ºï¼æˆ‘å€‘æœƒç›¡å¿«èˆ‡æ‚¨è¯ç¹«ã€‚');
                        setView('success');
                        resetForm();
                    } catch (error) {
                        console.error("Add doc error:", error);
                        let errorMsg = "é€å‡ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯";
                        if (error.code === 'permission-denied') errorMsg = "æ¬Šé™ä¸è¶³ (Firestore Rules)";
                        showNotification(errorMsg, "error");
                    }
                }
            };

            const resetForm = () => {
                setFormData({
                    groupName: '', groupType: '', groupTypeOther: '',
                    visitDate: '', timeStart: '', timeEnd: '',
                    contactPerson: '', jobTitle: '', phone: '', email: '',
                    visitorCount: '', identity: [], disabledCount: '',
                    needs: [], needsOther: '', volunteerCert: false, expectations: ''
                });
            };

            // å¾Œå°ç™»å…¥
            const [loginData, setLoginData] = useState({ username: '', password: '' });
            const handleLogin = (e) => {
                e.preventDefault();
                if (loginData.username === 'admin' && loginData.password === '22335678') {
                    setIsAdmin(true);
                    setView('admin-dashboard');
                } else {
                    showNotification('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤', 'error');
                }
            };

            // æ›´æ–°ç‹€æ…‹
            const updateStatus = async (id, newStatus) => {
                if (isDemoMode) {
                    setApplications(apps => apps.map(app => app.id === id ? { ...app, status: newStatus } : app));
                    showNotification(`ç‹€æ…‹æ›´æ–°ç‚ºï¼š${newStatus} (æ¼”ç¤º)`);
                    return;
                }
                try {
                    const docRef = doc(db, COLLECTION_NAME, id);
                    await updateDoc(docRef, { status: newStatus });
                    showNotification(`ç‹€æ…‹æ›´æ–°æˆåŠŸ`);
                } catch (error) {
                    console.error(error);
                    showNotification("æ›´æ–°å¤±æ•—", "error");
                }
            };

            // --------------------------------------------------------------
            // UI è¦–åœ–çµ„ä»¶
            // --------------------------------------------------------------
            const HomeView = () => (
                <div className="flex flex-col items-center justify-center min-h-[60vh] text-center space-y-8 animate-fade-in">
                    {configError && (
                        <div className="w-full max-w-2xl bg-amber-50 border-l-4 border-amber-500 text-amber-800 p-4 text-left shadow-sm">
                            <p className="font-bold">âš ï¸ ç³»çµ±ç›®å‰è™•æ–¼ã€Œæ¼”ç¤ºæ¨¡å¼ã€</p>
                            <p className="text-sm mt-1">{configError}</p>
                            <p className="text-sm text-amber-600 mt-2">è¨­å®šå®Œæˆå¾Œï¼Œè«‹é‡æ–°æ•´ç†é é¢ã€‚</p>
                        </div>
                    )}
                    <div className="max-w-2xl px-6">
                        <h1 className="text-4xl font-bold text-gray-800 mb-4">è’™æ©è½éšœçƒ˜ç„™åŠ</h1>
                        <h2 className="text-2xl text-orange-600 mb-6 font-medium">åƒè¨ªç”³è«‹ç³»çµ±</h2>
                        <p className="text-gray-600 mb-8 leading-relaxed">
                            æ­¡è¿ä¾†åˆ°è’™æ©ï¼æˆ‘å€‘æä¾›å·¥å» å°è¦½ã€å¿—å·¥æœå‹™èˆ‡ä¼æ¥­ ESG åˆä½œæ–¹æ¡ˆã€‚<br/>
                            è«‹å¡«å¯«ç”³è«‹è¡¨ï¼Œæˆ‘å€‘å°‡å®‰æ’å°ˆäººå¸¶é ˜æ‚¨èªè­˜è½éšœå°±æ¥­èˆ‡çƒ˜ç„™çš„ä¸–ç•Œã€‚
                        </p>
                        <div className="flex flex-col sm:flex-row gap-4 justify-center">
                            <button onClick={() => setView('form')} className="px-8 py-4 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-lg font-bold shadow-lg transition-all transform hover:-translate-y-1">
                                ğŸ“ å¡«å¯«åƒè¨ªç”³è«‹
                            </button>
                            <button onClick={() => setView('admin-login')} className="px-8 py-4 bg-white border-2 border-gray-200 hover:border-gray-300 text-gray-700 rounded-lg text-lg font-medium transition-all">
                                ğŸ”’ åŒä»ç™»å…¥å¾Œå°
                            </button>
                        </div>
                        <div className="mt-12 p-6 bg-orange-50 rounded-xl border border-orange-100 text-left text-sm text-gray-600">
                            <h3 className="font-bold text-orange-800 mb-2">ğŸ’¡ åƒè¨ªéœ€çŸ¥</h3>
                            <ul className="list-disc list-inside space-y-1 ml-1">
                                <li>è«‹æ–¼ <strong>ä¸€å€‹æœˆå‰</strong> æå‡ºç”³è«‹ï¼Œä»¥åˆ©è¯ç¹«åŠå®‰æ’ã€‚</li>
                                <li>å¯åƒè¨ªæ™‚é–“ï¼šé€±ä¸€ã€é€±ä¸‰ã€é€±å››ã€é€±äº” 09:00~16:00ã€‚</li>
                                <li>åœ°å€ï¼šå°ä¸­å¸‚åŒ—å±¯å€åŒ—å±¯è·¯210è™ŸB1ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );

            const FormView = () => (
                <div className="max-w-3xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden animate-slide-up mt-8">
                    <div className="bg-orange-500 p-6 text-white flex justify-between items-center">
                        <h2 className="text-2xl font-bold">ğŸ“ åƒè¨ªç”³è«‹è¡¨</h2>
                        <div className="flex gap-4 items-center">
                            {isDemoMode && <span className="bg-white/20 px-2 py-1 rounded text-xs">æ¼”ç¤ºæ¨¡å¼</span>}
                            <button onClick={() => setView('home')} className="text-white/80 hover:text-white underline text-sm">å›é¦–é </button>
                        </div>
                    </div>
                    <form onSubmit={handleSubmit} className="p-8 space-y-8">
                        {/* åœ˜é«”è³‡æ–™ */}
                        <section className="space-y-4">
                            <h3 className="text-lg font-bold text-gray-800 border-b pb-2 mb-4">ğŸ¢ åœ˜é«”è³‡æ–™</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">åœ˜é«”åç¨± (ç”³è«‹å–®ä½) *</label>
                                    <input required type="text" name="groupName" value={formData.groupName} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2" placeholder="ä¾‹å¦‚ï¼šæŸæŸå…¬å¸ / å­¸æ ¡" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">åœ˜é«”æ€§è³ª *</label>
                                    <select required name="groupType" value={formData.groupType} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2">
                                        <option value="">è«‹é¸æ“‡</option>
                                        <option value="å…¬å¸ï¼ä¼æ¥­">å…¬å¸ï¼ä¼æ¥­</option>
                                        <option value="å­¸æ ¡">å­¸æ ¡</option>
                                        <option value="æ”¿åºœå–®ä½">æ”¿åºœå–®ä½</option>
                                        <option value="ç¤¾ç¦åœ˜é«”">ç¤¾ç¦åœ˜é«”</option>
                                        <option value="å…¶ä»–">å…¶ä»–</option>
                                    </select>
                                    {formData.groupType === 'å…¶ä»–' && (
                                        <input type="text" name="groupTypeOther" value={formData.groupTypeOther} onChange={handleChange} placeholder="è«‹èªªæ˜" className="mt-2 w-full border border-gray-300 rounded-md p-2 text-sm" />
                                    )}
                                </div>
                            </div>
                        </section>

                        {/* åƒè¨ªæ™‚é–“ */}
                        <section className="space-y-4">
                            <h3 className="text-lg font-bold text-gray-800 border-b pb-2 mb-4">ğŸ“… é å®šåƒè¨ªæ™‚é–“</h3>
                            <p className="text-sm text-red-500 bg-red-50 p-2 rounded">â€» è«‹é ç´„ä¸€å€‹æœˆå¾Œçš„æ—¥æœŸã€‚é–‹æ”¾æ™‚é–“ï¼šé€±ä¸€ã€ä¸‰ã€å››ã€äº” 09:00~16:00</p>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">åƒè¨ªæ—¥æœŸ *</label>
                                    <input required type="date" name="visitDate" value={formData.visitDate} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">é–‹å§‹æ™‚é–“ *</label>
                                    <input required type="time" name="timeStart" value={formData.timeStart} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2" min="09:00" max="16:00"/>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">çµæŸæ™‚é–“ *</label>
                                    <input required type="time" name="timeEnd" value={formData.timeEnd} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2" min="09:00" max="16:00"/>
                                </div>
                            </div>
                        </section>

                        {/* è¯çµ¡äºº */}
                        <section className="space-y-4">
                            <h3 className="text-lg font-bold text-gray-800 border-b pb-2 mb-4">ğŸ‘¤ è¯çµ¡äººè³‡è¨Š</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label className="block text-sm font-medium text-gray-700 mb-1">è¯çµ¡äººå§“å *</label><input required type="text" name="contactPerson" value={formData.contactPerson} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2" /></div>
                                <div><label className="block text-sm font-medium text-gray-700 mb-1">è·ç¨±</label><input type="text" name="jobTitle" value={formData.jobTitle} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2" /></div>
                                <div><label className="block text-sm font-medium text-gray-700 mb-1">è¯çµ¡é›»è©± *</label><input required type="tel" name="phone" value={formData.phone} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2" /></div>
                                <div><label className="block text-sm font-medium text-gray-700 mb-1">Email *</label><input required type="email" name="email" value={formData.email} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2" /></div>
                            </div>
                        </section>

                        {/* åƒè¨ªç´°ç¯€ */}
                        <section className="space-y-4">
                            <h3 className="text-lg font-bold text-gray-800 border-b pb-2 mb-4">ğŸ’¼ åƒè¨ªç´°ç¯€</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">åƒè¨ªç¸½äººæ•¸ *</label>
                                    <input required type="number" name="visitorCount" value={formData.visitorCount} onChange={handleChange} className="w-full border border-gray-300 rounded-md p-2" min="1" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">èº«ä»½åˆ¥ (å¯è¤‡é¸) *</label>
                                    <div className="space-y-2">
                                        <label className="flex items-center"><input type="checkbox" name="identity" value="ä¸€èˆ¬èº«ä»½åˆ¥" checked={formData.identity.includes('ä¸€èˆ¬èº«ä»½åˆ¥')} onChange={handleChange} className="mr-2" /> ä¸€èˆ¬èº«ä»½åˆ¥</label>
                                        <div className="flex items-center flex-wrap gap-2">
                                            <label className="flex items-center"><input type="checkbox" name="identity" value="èº«å¿ƒéšœç¤™è€…" checked={formData.identity.includes('èº«å¿ƒéšœç¤™è€…')} onChange={handleChange} className="mr-2" /> èº«å¿ƒéšœç¤™è€…</label>
                                            {formData.identity.includes('èº«å¿ƒéšœç¤™è€…') && <input type="number" name="disabledCount" value={formData.disabledCount} onChange={handleChange} placeholder="èº«éšœäººæ•¸" className="w-24 text-sm border rounded px-2 py-1" />}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-gray-50 p-4 rounded-md mt-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">åƒè¨ªéœ€æ±‚</label>
                                <div className="space-y-2">
                                    <label className="flex items-center"><input type="checkbox" name="needs" value="èªè­˜è’™æ©èˆ‡å·¥å» å°è¦½" checked={formData.needs.includes('èªè­˜è’™æ©èˆ‡å·¥å» å°è¦½')} onChange={handleChange} className="mr-2" /> èªè­˜è’™æ©èˆ‡å·¥å» å°è¦½ (å½±ç‰‡å°è¦½)</label>
                                    <div className="flex items-center gap-2 flex-wrap">
                                        <label className="flex items-center"><input type="checkbox" name="needs" value="å¿—å·¥å¯¦ä½œæœå‹™" checked={formData.needs.includes('å¿—å·¥å¯¦ä½œæœå‹™')} onChange={handleChange} className="mr-2" /> å¿—å·¥å¯¦ä½œæœå‹™</label>
                                        {formData.needs.includes('å¿—å·¥å¯¦ä½œæœå‹™') && <label className="flex items-center text-sm bg-white px-2 rounded border"><input type="checkbox" name="volunteerCert" checked={formData.volunteerCert} onChange={handleChange} className="mr-2" /> éœ€è¦å¿—å·¥è­‰æ˜</label>}
                                    </div>
                                    <label className="flex items-center"><input type="checkbox" name="needs" value="æ¨å‹•ä¼æ¥­ ESGï¼CSR è¡Œå‹•" checked={formData.needs.includes('æ¨å‹•ä¼æ¥­ ESGï¼CSR è¡Œå‹•')} onChange={handleChange} className="mr-2" /> æ¨å‹•ä¼æ¥­ ESGï¼CSR è¡Œå‹•</label>
                                    <label className="flex items-center"><input type="checkbox" name="needs" value="å…¶ä»–ç›®çš„" checked={formData.needs.includes('å…¶ä»–ç›®çš„')} onChange={handleChange} className="mr-2" /> å…¶ä»–ï¼š</label>
                                    {formData.needs.includes('å…¶ä»–ç›®çš„') && <input type="text" name="needsOther" value={formData.needsOther} onChange={handleChange} className="border-b bg-transparent outline-none px-1 text-sm w-full" placeholder="è«‹èªªæ˜" />}
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">åƒè¨ªæœŸå¾…</label>
                                <textarea name="expectations" value={formData.expectations} onChange={handleChange} rows="3" className="w-full border border-gray-300 rounded-md p-2"></textarea>
                            </div>
                        </section>

                        <div className="pt-4 flex justify-center">
                            <button type="submit" className="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-12 rounded-lg shadow-md transition-colors text-lg">æäº¤ç”³è«‹</button>
                        </div>
                    </form>
                </div>
            );

            const SuccessView = () => (
                <div className="flex flex-col items-center justify-center h-[60vh] text-center animate-fade-in">
                    <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-6">
                        <span className="text-4xl">âœ…</span>
                    </div>
                    <h2 className="text-3xl font-bold text-gray-800 mb-4">ç”³è«‹å·²æˆåŠŸé€å‡ºï¼</h2>
                    <p className="text-gray-600 max-w-md mb-8">æ„Ÿè¬æ‚¨å°è’™æ©çš„æ”¯æŒã€‚æˆ‘å€‘çš„åŒä»å°‡æœƒå¯©æ ¸æ‚¨çš„ç”³è«‹ï¼Œä¸¦é€éé›»è©±æˆ– Email èˆ‡æ‚¨è¯ç¹«ã€‚</p>
                    <button onClick={() => setView('home')} className="text-orange-600 font-medium hover:underline">å›åˆ°é¦–é </button>
                </div>
            );

            const AdminLogin = () => (
                <div className="flex items-center justify-center min-h-[60vh]">
                    <div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-md border border-gray-100">
                        <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">åŒä»å¾Œå°ç™»å…¥</h2>
                        <form onSubmit={handleLogin} className="space-y-6">
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">å¸³è™Ÿ</label><input type="text" value={loginData.username} onChange={e => setLoginData({...loginData, username: e.target.value})} className="w-full border p-2 rounded" /></div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">å¯†ç¢¼</label><input type="password" value={loginData.password} onChange={e => setLoginData({...loginData, password: e.target.value})} className="w-full border p-2 rounded" /></div>
                            <button type="submit" className="w-full bg-gray-800 text-white py-2 rounded hover:bg-gray-700">ç™»å…¥</button>
                            <div className="text-xs text-gray-400 text-center">æç¤º: admin / 22335678</div>
                        </form>
                        <div className="mt-4 text-center"><button onClick={() => setView('home')} className="text-sm text-gray-500 hover:text-gray-800">è¿”å›é¦–é </button></div>
                    </div>
                </div>
            );

            const AdminDashboard = () => (
                <div className="animate-fade-in mt-8">
                    <div className="bg-white shadow-sm border-b px-6 py-4 flex justify-between items-center mb-6 rounded-t-lg">
                        <h2 className="text-xl font-bold text-gray-800">ğŸ’¼ åƒè¨ªç”³è«‹ç®¡ç†å¾Œå°</h2>
                        <button onClick={() => {setIsAdmin(false); setView('home');}} className="text-sm text-red-600 hover:text-red-700 font-medium">ğŸšª ç™»å‡º</button>
                    </div>
                    <div className="bg-white rounded-lg shadow overflow-x-auto">
                        <table className="w-full text-sm text-left text-gray-500">
                            <thead className="text-xs text-gray-700 uppercase bg-gray-50 border-b">
                                <tr>
                                    <th className="px-6 py-3">ç‹€æ…‹</th>
                                    <th className="px-6 py-3">åƒè¨ªæ—¥æœŸ</th>
                                    <th className="px-6 py-3">åœ˜é«”åç¨±</th>
                                    <th className="px-6 py-3">è¯çµ¡äºº</th>
                                    <th className="px-6 py-3">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {applications.length === 0 ? <tr><td colSpan="5" className="text-center py-8">ç„¡è³‡æ–™</td></tr> : applications.map((app) => (
                                    <tr key={app.id} className="bg-white border-b hover:bg-gray-50">
                                        <td className="px-6 py-4"><span className={`px-2 py-1 rounded text-xs ${app.status==='pending'?'bg-yellow-100 text-yellow-800':app.status==='contacted'?'bg-blue-100 text-blue-800':'bg-green-100 text-green-800'}`}>{app.status === 'pending' ? 'å¾…è™•ç†' : app.status === 'contacted' ? 'å·²è¯ç¹«' : app.status === 'confirmed' ? 'å·²ç¢ºèª' : app.status}</span></td>
                                        <td className="px-6 py-4">{app.visitDate}<br/><span className="text-xs">{app.timeStart}-{app.timeEnd}</span></td>
                                        <td className="px-6 py-4 font-bold">{app.groupName}<div className="text-xs font-normal text-gray-500">{app.visitorCount}äºº</div></td>
                                        <td className="px-6 py-4">{app.contactPerson}<br/>{app.phone}</td>
                                        <td className="px-6 py-4">
                                            <select value={app.status} onChange={(e) => updateStatus(app.id, e.target.value)} className="border rounded p-1 text-xs">
                                                <option value="pending">å¾…è™•ç†</option>
                                                <option value="contacted">å·²è¯ç¹«</option>
                                                <option value="confirmed">å·²ç¢ºèª</option>
                                                <option value="rejected">ç„¡æ³•å®‰æ’</option>
                                            </select>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            // ä¸»ç•«é¢æ¸²æŸ“
            return (
                <div className="min-h-screen">
                    <nav className="bg-white border-b px-4 py-4 flex justify-between items-center shadow-sm">
                        <div className="flex items-center text-xl font-bold text-gray-800 cursor-pointer" onClick={()=>setView('home')}>
                            <span className="mr-2 text-orange-600">â¤ï¸</span> è’™æ©è½éšœçƒ˜ç„™åŠ
                        </div>
                        <div className="text-sm text-gray-500">ğŸ“ (04) 2233-2525 #306 å»–å°å§</div>
                    </nav>
                    
                    {notification && (
                        <div className={`fixed top-20 right-4 p-4 rounded shadow-lg text-white z-50 ${notification.type === 'error' ? 'bg-red-500' : 'bg-green-500'}`}>
                            {notification.message}
                        </div>
                    )}

                    <main className="max-w-7xl mx-auto px-4 py-8">
                        {view === 'home' && <HomeView />}
                        {view === 'form' && <FormView />}
                        {view === 'success' && <SuccessView />}
                        {view === 'admin-login' && <AdminLogin />}
                        {view === 'admin-dashboard' && <AdminDashboard />}
                    </main>

                    <footer className="bg-white border-t py-6 text-center text-sm text-gray-500 mt-auto">
                        <p>Â© 2025 è’™æ©è½éšœçƒ˜ç„™åŠ</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VisitSystem />);
    </script>
</body>
</html>
